!function(a){var b={key_box_id:"woocommerce_amazon_payments_advanced_keys_json",are_keys_set:amazon_admin_params.keys_already_set,init:function(){this.are_keys_set&&b.hide_key_box(),a("label[for="+this.key_box_id+"]").click(function(){b.show_key_box()})},hide_key_box:function(){a("#"+this.key_box_id).hide()},show_key_box:function(){a("#"+this.key_box_id).show()}};b.init();var c={simple_path_form_id:"simple_path",payment_region_input:a("#woocommerce_amazon_payments_advanced_payment_region"),json_key_input:a("#woocommerce_amazon_payments_advanced_keys_json"),action_url:"#",spId:"",register_now_link:a("a.register_now"),locale:amazon_admin_params.locale,home_url:amazon_admin_params.home_url,merchant_unique_id:amazon_admin_params.merchant_unique_id,public_key:amazon_admin_params.public_key,exchange_url:amazon_admin_params.simple_path_url,privacy_url:amazon_admin_params.privacy_url,site_description:amazon_admin_params.description,poll_timer:!1,poll_interval:3e3,init:function(){c.payment_region_on_change(),c.create_form(),c.payment_region_input.on("change",this.payment_region_on_change),c.json_key_input.on("change paste keyup",this.json_key_on_change),c.register_now_link.on("click",this.register_link_on_click)},payment_region_on_change:function(){"jp"===c.get_region_selected()?(c.register_now_link.attr("href",c.get_simple_path_url()),c.register_now_link.attr("target","_blank")):(c.register_now_link.attr("href","#"),c.register_now_link.removeAttr("target"),c.action_url=c.get_simple_path_url(),c.spId=c.get_spId(),a("#"+c.simple_path_form_id).attr("action",c.action_url),a("input[name=spId]").val(c.spId))},json_key_on_change:function(){try{var b=a.parseJSON(a(this).val());c.json_key_input.removeClass("json_key_error"),c.json_key_input.addClass("json_key_valid"),a("#woocommerce_amazon_payments_advanced_seller_id").val(b.merchant_id),a("#woocommerce_amazon_payments_advanced_mws_access_key").val(b.access_key),a("#woocommerce_amazon_payments_advanced_secret_key").val(b.secret_key),a("#woocommerce_amazon_payments_advanced_app_client_id").val(b.client_id),a("#woocommerce_amazon_payments_advanced_app_client_secret").val(b.client_secret)}catch(d){c.json_key_input.removeClass("json_key_valid"),c.json_key_input.addClass("json_key_error")}},register_link_on_click:function(){"jp"!==c.get_region_selected()&&(document.getElementById(c.simple_path_form_id).submit.click(),c.poll_timer=setTimeout(c.poll_for_keys,c.poll_interval))},create_form:function(){a(".wrap.woocommerce").append(a("<form/>",{id:c.simple_path_form_id,action:c.action_url,method:"post",target:"_blank"}).append(a("<input/>",{type:"hidden",name:"spId",value:c.spId}),a("<input/>",{type:"hidden",name:"publicKey",value:c.public_key}),a("<input/>",{type:"hidden",name:"keyShareURL",value:c.exchange_url}),a("<input/>",{type:"hidden",name:"locale",value:c.locale}),a("<input/>",{type:"hidden",name:"merchantLoginDomains[]",value:c.home_url}),a("<input/>",{type:"hidden",name:"merchantLoginRedirectURLs[]",value:c.exchange_url}),a("<input/>",{type:"hidden",name:"merchantPrivacyNoticeURL",value:c.privacy_url}),a("<input/>",{type:"hidden",name:"merchantStoreDescription",value:c.site_description}),a("<input/>",{type:"hidden",name:"source",value:"SPPL"}),a("<input/>",{type:"submit",name:"submit",style:"display:none",value:"submit"})))},get_region_selected:function(){return c.payment_region_input.val()},get_simple_path_url:function(){return amazon_admin_params.simple_path_urls[c.get_region_selected()]},get_spId:function(){return amazon_admin_params.spids[c.get_region_selected()]},poll_for_keys:function(){clearTimeout(c.poll_timer),a.ajax({url:amazon_admin_params.ajax_url,data:{action:"amazon_check_credentials",nonce:amazon_admin_params.credentials_nonce},type:"GET",success:function(a){"1"===a?location.reload():c.poll_timer=setTimeout(c.poll_for_keys,c.poll_interval)}})}};c.init()}(jQuery);